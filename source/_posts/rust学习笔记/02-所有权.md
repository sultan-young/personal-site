---
title: 02_所有权【重点】
date: 2022-09-23 15:08:48
categories: [rust]
tags: [rust]
---
> 所有权是Rust中最为与众不同的特性，他让Rust无需垃圾回收器(garbage collector)即可保证内存安全。因此，理解Rust中所有权的运作方式非常重要。

<!--more-->
## 什么是所有权？
所有运行的程序都必须管理器计算机的内存。一些预览具有垃圾回收机制，在程序运行过程中不断地寻找不再使用的内存(例如JavaScript)。另一些语言需要开发者亲自分配和释放内存（例如c，c++）。
Rust使用了第三种方式：通过所有权系统管理内存，编译期在编辑时会根据一系列的规则进行检查。在运行时，所有权系统的任何功能都不会减慢程序。

## 所有权规则
+ Rust中的每个值都有一个被称为其 **所有者** 的变量。
+ 值在任何一刻只能有一个所有者。
+ 当所有者（变量）离开作用域，这个值将会丢弃。

## 栈（Stack）与 堆 (Heap)
在很多语言中，你并不需要关注到堆和栈。但在像Rust这样的系统编程语言中，值是位于栈上还是堆上很大程度上影响了语言的行为（表示很模棱两可，我在这里姑且认为是会影响到程序的性能）。
堆和栈都是代码在运行时可供使用的内存，但是它们不尽相同：

### 栈
+ 栈以放入值的顺序存储值，并以相反的顺序取出值。这也被称为 **后进先出**。
+ 栈中所有的数据都必须占用已知且固定的大小。
+ 栈上访问数据会比堆更快。因为栈中的数据 “距离” 相对将近。
+ 栈中分配内存会更快，因为它无需为数据搜索新的内存空间，其存放位置总是在栈顶。
+ 指针存放在栈上，因为指针的大小是已知且固定的。


### 堆
+ 堆中可以存放未知的或大小可能变化的数据。
+ 堆存放数据时候，需要先请求一定大小的空间。内存分配器会在堆中的某处找到一块足够大的空位，并将其标记为使用，之后返回一个表示该地址位置的 **指针**。